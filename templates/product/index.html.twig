{% extends 'base.html.twig' %}

{% block title %}Product index
{% endblock %}
{% block stylesheets %}
	<link rel="stylesheet" href="{{ asset('styles/products.scss') }}">
{% endblock %}

{% block javascripts %}
	{% block importmap %}
		{{ importmap(['app']) }}
	{% endblock %}
{% endblock %}

{% block body %}

	<div class="productList_navbar">
		{{ include('product/_partiel/productCategoryList.html.twig') }}
		{{ include('product/_partiel/productFiltres.html.twig') }}
	</div>

	<div class="productList">
		{% for product in products %}
			<div class="productList__conteiner">
				<div class="product__card">
					<a href="{{ path('app_product_show', { 'id': product.id }) }}">
						<img src="{{ vich_uploader_asset(product) }}" class="card-img-top" alt="{{ product.name }}">

						<div class="productList__body">
							<h5 class="productList__title">
								{{ product.name }}
							</h5>
							{% if product.weight is not null and product.weight > 0 %}

								{% if not is_granted('ROLE_CHARITY_ASSOCIATION') %}
									<div class="productList__body_prix">
										<p class="productList__prix">
											{{ product.price | format_currency('EUR', locale='fr') }}
										</p>
										<p>
											(
											{{ (product.price / product.weight) | number_format(2, '.', ',') }}
											€/{{ product.unit.value }}
											)
										</p>
									</div>
								{% else %}
									<div class="productList__body_prix">
										<p class="productList__prix">
											{{ (product.price * 2) | format_currency('point', locale='fr') }}
										</p>
									</div>
								{% endif %}


							{% elseif product.volumeLitre is not null and product.volumeLitre > 0 %}
								<p class="productList__prix">
									{{ product.volumeLitre }}
									{{ product.unit.value }}
								</p>

								<div>
									(
									{{ (product.price / product.volumeLitre) | number_format(2, '.', ',') }}
									€/{{ product.unit.value }}
									)
								</div>
							{% endif %}


						</div>


					</a>
					{% if productForms[product.id] is defined %}
						{{ form_start(productForms[product.id]) }}
						{{ form_widget(productForms[product.id].quantity, {'attr': {'class': 'productList__total'}}) }}
						<button type="submit" class="productList__AddToBasket">Ajouter au panier</button>
						{{ form_end(productForms[product.id]) }}
					{% else %}
						<span>gregerger</span>
					{% endif %}


				</div>


			</div>
		{% else %}
			<div class="productList__no-products" role="alert">
				Aucun produit trouvé.
			</div>
		{% endfor %}
	</div>

{% endblock %}
